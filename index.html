<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SKF Karate Admission Form - MP Sports Club</title>
    <style>
      :root {
        /* Black Martial Arts Theme Colors */
        --karate-bg-primary: #0a0a0a;
        --karate-bg-secondary: #1a1a1a;
        --karate-bg-surface: #2a2a2a;
        --karate-bg-elevated: #333333;

        /* Metallic Colors */
        --metallic-silver: #c0c0c0;
        --metallic-bright-silver: #e8e8e8;
        --metallic-dark-silver: #909090;
        --metallic-gold: #d4af37;
        --metallic-chrome: #f0f0f0;

        /* Text Colors */
        --text-primary: #ffffff;
        --text-secondary: #c0c0c0;
        --text-muted: #909090;
        --text-accent: #d4af37;

        /* Status Colors */
        --status-success: #22c55e;
        --status-error: #ef4444;
        --status-warning: #f59e0b;
        --status-info: #3b82f6;

        /* Effects */
        --shadow-premium: 0 8px 32px rgba(0, 0, 0, 0.5);
        --shadow-elevated: 0 4px 16px rgba(0, 0, 0, 0.3);
        --shadow-glow: 0 0 20px rgba(192, 192, 192, 0.3);
        --shadow-gold-glow: 0 0 15px rgba(212, 175, 55, 0.4);

        /* Gradients */
        --gradient-metallic: linear-gradient(
          135deg,
          #e8e8e8 0%,
          #c0c0c0 25%,
          #ffffff 50%,
          #c0c0c0 75%,
          #e8e8e8 100%
        );
        --gradient-dark: linear-gradient(135deg, #0a0a0a 0%, #2a2a2a 100%);
        --gradient-surface: linear-gradient(135deg, #1a1a1a 0%, #333333 100%);
        --gradient-button: linear-gradient(135deg, #c0c0c0 0%, #909090 100%);

        /* RGB versions for opacity control */
        --metallic-silver-rgb: 192, 192, 192;
        --karate-bg-primary-rgb: 10, 10, 10;
        --text-primary-rgb: 255, 255, 255;

        /* Semantic mappings */
        --color-background: var(--karate-bg-primary);
        --color-surface: var(--karate-bg-secondary);
        --color-text: var(--text-primary);
        --color-text-secondary: var(--text-secondary);
        --color-primary: var(--metallic-silver);
        --color-primary-hover: var(--metallic-bright-silver);
        --color-primary-active: var(--metallic-dark-silver);
        --color-secondary: rgba(var(--metallic-silver-rgb), 0.15);
        --color-secondary-hover: rgba(var(--metallic-silver-rgb), 0.25);
        --color-secondary-active: rgba(var(--metallic-silver-rgb), 0.35);
        --color-border: rgba(var(--metallic-silver-rgb), 0.3);
        --color-btn-primary-text: var(--karate-bg-primary);
        --color-card-border: rgba(var(--metallic-silver-rgb), 0.2);
        --color-card-border-inner: rgba(var(--metallic-silver-rgb), 0.15);
        --color-error: var(--status-error);
        --color-success: var(--status-success);
        --color-warning: var(--status-warning);
        --color-info: var(--status-info);
        --color-focus-ring: rgba(var(--metallic-silver-rgb), 0.4);
        /* Fixed missing vars */
        --color-gray-200: #333333;
        --color-bg-3: rgba(255, 255, 255, 0.05);
        --karate-red: #ef4444;

        /* Typography */
        --font-family-base: "Inter", "Segoe UI", Roboto, sans-serif;
        --font-family-heading: "Inter", "Segoe UI", Roboto, sans-serif;
        --font-size-xs: 11px;
        --font-size-sm: 12px;
        --font-size-base: 14px;
        --font-size-md: 14px;
        --font-size-lg: 16px;
        --font-size-xl: 18px;
        --font-size-2xl: 20px;
        --font-size-3xl: 24px;
        --font-size-4xl: 30px;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-semibold: 550;
        --font-weight-bold: 600;
        --line-height-tight: 1.2;
        --line-height-normal: 1.5;
        --letter-spacing-tight: -0.01em;

        /* Spacing */
        --space-0: 0;
        --space-1: 1px;
        --space-2: 2px;
        --space-4: 4px;
        --space-6: 6px;
        --space-8: 8px;
        --space-10: 10px;
        --space-12: 12px;
        --space-16: 16px;
        --space-20: 20px;
        --space-24: 24px;
        --space-32: 32px;

        /* Border Radius */
        --radius-sm: 6px;
        --radius-base: 8px;
        --radius-md: 10px;
        --radius-lg: 12px;
        --radius-full: 9999px;

        /* Shadows */
        --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04),
          0 1px 2px rgba(0, 0, 0, 0.02);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
          0 2px 4px -1px rgba(0, 0, 0, 0.02);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
          0 4px 6px -2px rgba(0, 0, 0, 0.02);

        /* Animation */
        --duration-fast: 150ms;
        --duration-normal: 250ms;
        --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-family-base);
        background: var(--gradient-dark);
        min-height: 100vh;
        color: var(--color-text);
        line-height: var(--line-height-normal);
        position: relative;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(
            circle at 20% 80%,
            rgba(212, 175, 55, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(192, 192, 192, 0.03) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: -1;
      }

      .app-container {
        max-width: 800px;
        margin: 0 auto;
        padding: var(--space-20);
      }

      .form-header {
        text-align: center;
        margin-bottom: var(--space-32);
        background: var(--gradient-surface);
        padding: var(--space-24);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-premium);
        border: 1px solid var(--color-border);
        position: relative;
        overflow: hidden;
      }

      .form-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.05),
          transparent
        );
        animation: headerShine 3s infinite;
      }

      @keyframes headerShine {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .logo {
        margin-bottom: 0.5rem;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        line-height: 0.9;
      }

      .logo-skf,
      .logo-karate {
        font-weight: 800;
        background: var(--gradient-metallic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: var(--shadow-glow);
        position: relative;
        display: inline-block;
        letter-spacing: 0.03em;
        animation: logoGlow 2s ease-in-out infinite alternate;
      }

      .logo-skf {
        font-size: clamp(4rem, 14vw, 8rem);
        margin-bottom: 0.2rem;
        line-height: 0.9;
      }

      .logo-karate {
        font-size: clamp(2.5rem, 8vw, 5rem);
        line-height: 0.9;
      }

      @keyframes logoGlow {
        0% {
          filter: drop-shadow(0 0 5px rgba(192, 192, 192, 0.5));
          transform: scale(1);
        }
        100% {
          filter: drop-shadow(0 0 15px rgba(192, 192, 192, 0.8));
          transform: scale(1.02);
        }
      }

      .logo-skf::after,
      .logo-karate::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.3) 50%,
          transparent 70%
        );
        animation: logoShine 3s infinite;
        pointer-events: none;
      }

      @keyframes logoShine {
        0% {
          transform: translateX(-100%) skewX(-15deg);
        }
        100% {
          transform: translateX(200%) skewX(-15deg);
        }
      }

      .tagline {
        font-size: var(--font-size-lg);
        color: var(--text-secondary);
        margin-bottom: var(--space-16);
        font-weight: 500;
      }

      .urgency-banner {
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid var(--metallic-gold);
        border-radius: var(--radius-base);
        padding: var(--space-12);
        font-size: var(--font-size-sm);
        color: var(--metallic-gold);
        font-weight: var(--font-weight-medium);
        box-shadow: var(--shadow-gold-glow);
      }

      .form-card {
        background: var(--gradient-surface);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-premium);
        border: 1px solid var(--color-border);
        overflow: hidden;
        position: relative;
      }

      .progress-bar {
        height: 4px;
        background: var(--color-gray-200);
        position: relative;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient-metallic);
        transition: width var(--duration-normal) var(--ease-standard);
        width: 0%;
        box-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
      }

      .step-indicator {
        padding: var(--space-16) var(--space-24);
        background: rgba(var(--metallic-silver-rgb), 0.05);
        border-bottom: 1px solid var(--color-border);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        color: var(--text-secondary);
      }

      .form-section {
        padding: var(--space-24);
        display: none;
        background: var(--karate-bg-secondary);
      }

      .form-section.active {
        display: block;
      }

      .section-title {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-text);
        margin-bottom: var(--space-8);
      }

      .section-subtitle {
        font-size: var(--font-size-base);
        color: var(--color-text-secondary);
        margin-bottom: var(--space-24);
      }

      .form-group {
        margin-bottom: var(--space-20);
      }

      .form-label {
        display: block;
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        color: var(--color-text);
        margin-bottom: var(--space-6);
      }

      label[for="promoCode"].form-label.required::after {
        content: "" !important;
      }

      .form-label.required::after {
        content: " *";
        color: var(--color-error);
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: var(--space-12);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        font-size: var(--font-size-base);
        font-family: inherit;
        transition: all var(--duration-fast) var(--ease-standard);
        background: var(--karate-bg-surface);
        color: var(--text-primary);
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--metallic-silver);
        box-shadow: var(--shadow-glow);
        background: var(--karate-bg-elevated);
      }

      .form-input.error,
      .form-select.error,
      .form-textarea.error {
        border-color: var(--color-error);
      }

      .error-message {
        font-size: var(--font-size-xs);
        color: var(--color-error);
        margin-top: var(--space-4);
        display: none;
      }

      .error-message.show {
        display: block;
      }

      .promo-code-section {
        background: rgba(var(--metallic-silver-rgb), 0.05);
        border: 1px solid var(--metallic-silver);
        border-radius: var(--radius-base);
        padding: var(--space-20);
        margin-bottom: var(--space-20);
        box-shadow: var(--shadow-elevated);
        position: relative;
      }

      .package-confirmation {
        background: var(--color-bg-3);
        border: 1px solid var(--color-success);
        border-radius: var(--radius-base);
        padding: var(--space-16);
        margin-bottom: var(--space-20);
      }

      .package-title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--color-success);
        margin-bottom: var(--space-12);
      }

      .package-details {
        display: grid;
        gap: var(--space-8);
        font-size: var(--font-size-sm);
      }

      .package-detail {
        display: flex;
        align-items: center;
        gap: var(--space-8);
      }

      .package-detail .icon {
        font-size: var(--font-size-base);
      }

      .price-highlight {
        font-weight: var(--font-weight-bold);
        color: #ffffff; /* was red */
      }

      .savings-highlight {
        font-weight: var(--font-weight-bold);
        color: var(--status-success);
      }

      /* Diwali pricing visuals */
      .price-slashed {
        text-decoration: line-through;
        color: var(--text-muted);
        margin: 0 8px;
      }
      .price-now-gold {
        color: var(--metallic-gold);
        font-weight: 800;
        text-shadow: 0 0 6px rgba(212, 175, 55, 0.35);
      }
      .note-gold {
        color: var(--metallic-gold);
        font-weight: 600;
        margin-left: 6px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-16);
      }

      @media (max-width: 640px) {
        .form-row {
          grid-template-columns: 1fr;
        }
      }

      .form-actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-12);
        margin-top: var(--space-32);
        padding-top: var(--space-20);
        border-top: 1px solid var(--color-border);
      }

      .btn {
        width: 100%;
        max-width: 400px;
        min-height: 50px;
        margin: 1rem auto;
        padding: 14px 20px;
        border: none;
        border-radius: var(--radius-base);
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
        display: block;
        text-align: center;
        text-decoration: none;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-primary {
        background: var(--gradient-button);
        color: var(--color-btn-primary-text);
        border: 1px solid var(--color-border);
        box-shadow: var(--shadow-elevated);
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .btn-primary:hover:not(:disabled) {
        background: var(--gradient-metallic);
        box-shadow: var(--shadow-premium);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: var(--color-secondary);
        color: var(--color-text);
        border: 1px solid var(--color-border);
        transition: all 0.3s ease;
      }

      .btn-secondary:hover:not(:disabled) {
        background: var(--color-secondary-hover);
        box-shadow: var(--shadow-elevated);
        transform: translateY(-1px);
      }

      .checkbox-group {
        display: flex;
        align-items: flex-start;
        gap: var(--space-8);
        margin-top: var(--space-16);
      }

      .checkbox-input {
        margin: 0;
        width: auto;
      }

      .checkbox-label {
        font-size: var(--font-size-sm);
        line-height: 1.4;
        cursor: pointer;
      }

      .loading {
        display: none;
        text-align: center;
        padding: var(--space-20);
      }

      .loading.show {
        display: block;
      }

      .success-message {
        background: var(--color-bg-3);
        border: 1px solid var(--color-success);
        border-radius: var(--radius-base);
        padding: var(--space-16);
        color: var(--color-success);
        text-align: center;
        display: none;
      }

      .success-message.show {
        display: block;
      }

      .hidden {
        display: none !important;
      }

      .child-section {
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        padding: var(--space-16);
        margin-bottom: var(--space-16);
        background: rgba(var(--metallic-silver-rgb), 0.03);
        box-shadow: var(--shadow-elevated);
      }

      .child-section-title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        color: var(--color-text);
        margin-bottom: var(--space-16);
        padding-bottom: var(--space-8);
        border-bottom: 1px solid var(--color-border);
      }

      .radio-group {
        display: flex;
        gap: var(--space-16);
        flex-wrap: wrap;
      }

      .radio-option {
        display: flex;
        align-items: center;
        gap: var(--space-6);
      }

      .radio-input {
        margin: 0;
        width: auto;
      }

      .radio-label {
        font-size: var(--font-size-sm);
        cursor: pointer;
      }

      .success-container {
        text-align: center;
        padding: 20px;
        background-color: #e6f4ea;
        border: 2px solid #4caf50;
        border-radius: 8px;
        margin: 20px auto;
        max-width: 600px;
      }
      .success-container h3 {
        color: #4caf50;
        font-size: 24px;
        margin-bottom: 15px;
      }
      .success-container p {
        color: #333;
        font-size: 16px;
        margin: 10px 0;
      }
      .pay-now-btn {
        display: inline-block;
        padding: 12px 24px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        font-weight: bold;
        border-radius: 5px;
        margin: 15px 0;
        transition: background-color 0.3s;
      }
      .pay-now-btn:hover {
        background-color: #0056b3;
      }
      .error-container {
        text-align: center;
        padding: 20px;
        background-color: #ffe6e6;
        border: 2px solid #dc3545;
        border-radius: 8px;
        margin: 20px auto;
        max-width: 600px;
      }
      .error-container h3 {
        color: #dc3545;
        font-size: 24px;
        margin-bottom: 15px;
      }
      .error-container p {
        color: #333;
        font-size: 16px;
        margin: 10px 0;
      }

      @media (max-width: 768px) {
        .app-container {
          padding: var(--space-16);
        }

        .form-header {
          padding: var(--space-16);
        }

        .form-section {
          padding: var(--space-16);
        }

        .btn {
          max-width: 100%;
          margin: 0.5rem auto;
        }
      }

      /* ===== Enhanced Loading Overlay (Centered in Form Container) ===== */
      .loading-overlay {
        position: absolute; /* Changed from fixed to scope to .form-card */
        inset: 0;
        background: rgba(10, 10, 10, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000; /* High but below header */
        transition: opacity 0.3s ease;
        opacity: 0;
      }
      .loading-overlay.show {
        opacity: 1;
      }
      .loading-box {
        text-align: center;
        color: var(--text-primary);
        padding: var(--space-24);
        background: var(--karate-bg-surface);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-premium);
        max-width: 90%;
      }
      .spinner {
        border: 4px solid rgba(212, 175, 55, 0.2); /* Gold theme */
        border-top: 4px solid var(--metallic-gold);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }
      #loadingText {
        font-size: var(--font-size-base);
        margin-top: var(--space-8);
        color: var(--metallic-gold);
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      #loadingOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(10, 10, 10, 0.97); /* opaque dark */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      #loadingOverlay .loading-box {
        color: #fff;
        font-size: 2rem;
        text-align: center;
      }
      .hidden {
        display: none !important;
      }

      /* ----- Section 8: Premium Thank-You Styling ----- */
      #section8 {
        background: #1a1a1a; /* deep charcoal */
        border: 1px solid rgba(212, 175, 55, 0.8); /* soft gold */
        border-radius: var(--radius-lg);
        padding: var(--space-32) var(--space-24);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      #section8::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 120%;
        height: 120%;
        background: radial-gradient(
          circle at center,
          rgba(212, 175, 55, 0.15),
          transparent 70%
        );
        transform: translate(-50%, -50%);
        pointer-events: none;
      }

      #section8 .section-title {
        font-family: "Cinzel", serif; /* elegant serif */
        font-size: clamp(2rem, 5vw, 3rem);
        color: #d4af37; /* metallic gold */
        letter-spacing: 0.05em;
        margin: 0 0 var(--space-16);
      }

      #section8 .section-subtitle {
        font-size: var(--font-size-lg);
        color: #e8e8e8; /* bright silver */
        margin-bottom: var(--space-24);
      }

      #thankYouContent {
        display: inline-block;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(212, 175, 55, 0.5);
        border-radius: var(--radius-md);
        padding: var(--space-24) var(--space-32);
        color: #c0c0c0; /* metallic silver text */
        font-family: "Roboto", sans-serif;
        font-size: var(--font-size-base);
        line-height: 1.6;
        max-width: 600px;
      }

      #thankYouContent big {
        display: block;
        font-size: var(--font-size-xl);
        color: #d4af37;
        margin-bottom: var(--space-12);
      }

      #thankYouContent strong {
        color: #ffffff;
        background: rgba(212, 175, 55, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div id="loadingOverlay" class="hidden">
      <div id="loadingText">Processing… 0%</div>
    </div>

    <div class="app-container">
      <div class="form-header">
        <div class="logo">
          <span class="logo-skf">SKF</span>
          <span class="logo-karate">KARATE</span>
        </div>
        <div class="tagline">with MP Sports Club</div>
        <div class="urgency-banner">
          ⏰ Limited seats available – priority for demonstration attendees.
        </div>
      </div>

      <div class="form-card">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="step-indicator" id="stepIndicator">
          Step 1 of 7: Welcome &amp; Promo Code
        </div>

        <form id="admissionForm">
          <!-- Section 1: Welcome & Promo Code -->
          <div class="form-section active" id="section1">
            <h2 class="section-title">Enter Your Promo Code</h2>
            <p class="section-subtitle">
              Please enter your promo code to see your exclusive package details
              and pricing.
            </p>

            <div class="promo-code-section">
              <div class="form-group">
                <label class="form-label" for="promoCode ">Promo Code</label>
                <input
                  type="text"
                  id="promoCode"
                  name="promoCode"
                  class="form-input"
                  placeholder="Enter promo code"
                />
                <div class="error-message" id="promoCodeError">
                  Please enter a valid promo code
                </div>
                <div
                  id="promoHelpNote"
                  style="
                    margin-top: 6px;
                    font-size: 13px;
                    color: var(--text-muted);
                  "
                >
                  Have a promo code? Enter it here — or simply continue.
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Package Confirmation -->
          <div class="form-section" id="section2">
            <h2 class="section-title">Package Confirmation</h2>
            <p class="section-subtitle">
              Confirm your selected package and review the exclusive benefits.
            </p>

            <div class="package-confirmation" id="packageDetails">
              <!-- Package details will be populated dynamically -->
            </div>

            <div class="checkbox-group">
              <input
                type="checkbox"
                id="termsAccept"
                name="termsAccept"
                class="checkbox-input"
                required
              />
              <label for="termsAccept" class="checkbox-label"
                >I accept the terms and conditions and confirm my package
                selection.</label
              >
              <div class="error-message" id="termsAcceptError"></div>
              <!-- Ensure this is present -->
            </div>
          </div>

          <!-- Section 3: Family & Guardian Details -->
          <div class="form-section" id="section3">
            <h2 class="section-title">Family &amp; Guardian Details</h2>
            <p class="section-subtitle">
              Behind every strong karateka is a supportive family
            </p>

            <div class="child-section">
              <h3 class="child-section-title">Primary Guardian</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required" for="guardianName"
                    >Full Name</label
                  >
                  <input
                    type="text"
                    id="guardianName"
                    name="guardianName"
                    class="form-input"
                    required
                  />
                  <div class="error-message" id="guardianNameError">
                    Full name is required
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label required" for="guardianRelationship"
                    >Relationship</label
                  >
                  <select
                    id="guardianRelationship"
                    name="guardianRelationship"
                    class="form-select"
                    required
                  >
                    <option value="">Select relationship</option>
                    <option value="Father">Father</option>
                    <option value="Mother">Mother</option>
                    <option value="Guardian">Guardian</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="error-message" id="guardianRelationshipError">
                    Please select a relationship
                  </div>
                </div>
              </div>
              <div
                class="form-group"
                id="guardianOtherGroup"
                style="display: none"
              >
                <label class="form-label" for="guardianOther"
                  >Specify Relationship</label
                >
                <input
                  type="text"
                  id="guardianOther"
                  name="guardianOther"
                  class="form-input"
                />
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required" for="guardianContact"
                    >Contact Number</label
                  >
                  <input
                    type="tel"
                    id="guardianContact"
                    name="guardianContact"
                    class="form-input"
                    placeholder="10-digit mobile number"
                    required
                  />
                  <div class="error-message" id="guardianContactError">
                    Please enter a valid 10-digit mobile number
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label required" for="guardianWhatsapp"
                    >WhatsApp Number</label
                  >
                  <input
                    type="tel"
                    id="guardianWhatsapp"
                    name="guardianWhatsapp"
                    class="form-input"
                    placeholder="For class/group updates"
                    required
                  />
                  <div class="error-message" id="guardianWhatsappError">
                    Please enter a valid WhatsApp number
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label required" for="guardianEmail"
                  >Email Address</label
                >
                <input
                  type="email"
                  id="guardianEmail"
                  name="guardianEmail"
                  class="form-input"
                  required
                />
                <div class="error-message" id="guardianEmailError">
                  Please enter a valid email address
                </div>
              </div>
            </div>

            <div class="child-section">
              <h3 class="child-section-title">Secondary Guardian (Optional)</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="guardianName2"
                    >Full Name</label
                  >
                  <input
                    type="text"
                    id="guardianName2"
                    name="guardianName2"
                    class="form-input"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label" for="guardianRelationship2"
                    >Relationship</label
                  >
                  <select
                    id="guardianRelationship2"
                    name="guardianRelationship2"
                    class="form-select"
                  >
                    <option value="">Select relationship</option>
                    <option value="Father">Father</option>
                    <option value="Mother">Mother</option>
                    <option value="Guardian">Guardian</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
              <div
                class="form-group"
                id="guardianOther2Group"
                style="display: none"
              >
                <label class="form-label" for="guardianOther2"
                  >Specify Relationship</label
                >
                <input
                  type="text"
                  id="guardianOther2"
                  name="guardianOther2"
                  class="form-input"
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="guardianContact2"
                  >Contact Number</label
                >
                <input
                  type="tel"
                  id="guardianContact2"
                  name="guardianContact2"
                  class="form-input"
                  placeholder="10-digit mobile number"
                />
              </div>
            </div>
          </div>

          <!-- Section 4: Children Information -->
          <div class="form-section" id="section4">
            <h2 class="section-title">Children Information</h2>
            <p class="section-subtitle">Tell us about your child(ren)</p>

            <div id="childrenContainer">
              <!-- Children forms will be populated dynamically -->
            </div>
          </div>

          <!-- Section 5: Martial Arts Experience -->
          <div class="form-section" id="section5">
            <h2 class="section-title">Martial Arts Experience</h2>
            <p class="section-subtitle">
              Please provide details about any previous martial arts training
            </p>

            <div id="experienceContainer">
              <!-- Experience forms will be populated dynamically -->
            </div>
          </div>

          <!-- Section 6: Referral Information -->
          <div class="form-section" id="section6">
            <h2 class="section-title">Referral Information</h2>
            <p class="section-subtitle">Great for friends joining together!</p>

            <div class="child-section">
              <h3 class="child-section-title">Friend's Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required" for="friendName"
                    >Friend's Full Name</label
                  >
                  <input
                    type="text"
                    id="friendName"
                    name="friendName"
                    class="form-input"
                  />
                  <div class="error-message" id="friendNameError">
                    Friend's name is required
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label required" for="friendChildName"
                    >Friend's Child Name</label
                  >
                  <input
                    type="text"
                    id="friendChildName"
                    name="friendChildName"
                    class="form-input"
                  />
                  <div class="error-message" id="friendChildNameError">
                    Friend's child name is required
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label required" for="friendContact"
                  >Friend's Contact / WhatsApp Number</label
                >
                <input
                  type="tel"
                  id="friendContact"
                  name="friendContact"
                  class="form-input"
                  placeholder="10-digit mobile number"
                />
                <div class="error-message" id="friendContactError">
                  Please enter a valid contact number
                </div>
              </div>
              <div class="form-group">
                <label class="form-label required" for="referrerStatus"
                  >Are you the referrer or referred friend?</label
                >
                <div class="radio-group">
                  <div class="radio-option">
                    <input
                      type="radio"
                      id="referrer"
                      name="referrerStatus"
                      value="referrer"
                      class="radio-input"
                    />
                    <label for="referrer" class="radio-label"
                      >I am referring my friend</label
                    >
                  </div>
                  <div class="radio-option">
                    <input
                      type="radio"
                      id="referred"
                      name="referrerStatus"
                      value="referred"
                      class="radio-input"
                    />
                    <label for="referred" class="radio-label"
                      >I was referred by my friend</label
                    >
                  </div>
                </div>
                <div class="error-message" id="referrerStatusError">
                  Please select your referrer status
                </div>
              </div>
            </div>
          </div>

          <!-- Section 7: Emergency Contact & Final Details -->
          <div class="form-section" id="section7">
            <h2 class="section-title">Emergency Contact &amp; Final Details</h2>
            <p class="section-subtitle">
              Almost done! Please provide emergency contact information
            </p>

            <div class="child-section">
              <h3 class="child-section-title">Emergency Contact</h3>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required" for="emergencyName"
                    >Full Name</label
                  >
                  <input
                    type="text"
                    id="emergencyName"
                    name="emergencyName"
                    class="form-input"
                    required
                  />
                  <div class="error-message" id="emergencyNameError">
                    Emergency contact name is required
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label required" for="emergencyRelationship"
                    >Relationship</label
                  >
                  <select
                    id="emergencyRelationship"
                    name="emergencyRelationship"
                    class="form-select"
                    required
                  >
                    <option value="">Select relationship</option>
                    <option value="Father">Father</option>
                    <option value="Mother">Mother</option>
                    <option value="Sister">Sister</option>
                    <option value="Brother">Brother</option>
                    <option value="Uncle/Aunt">Uncle/Aunt</option>
                    <option value="Family Friend">Family Friend</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="error-message" id="emergencyRelationshipError">
                    Please select a relationship
                  </div>
                </div>
              </div>
              <div
                class="form-group"
                id="emergencyOtherGroup"
                style="display: none"
              >
                <label class="form-label" for="emergencyOther"
                  >Specify Relationship</label
                >
                <input
                  type="text"
                  id="emergencyOther"
                  name="emergencyOther"
                  class="form-input"
                />
                <div class="error-message" id="emergencyOtherError">
                  Please specify the relationship
                </div>
              </div>
              <div class="form-group">
                <label class="form-label required" for="emergencyPhone"
                  >Phone Number</label
                >
                <input
                  type="tel"
                  id="emergencyPhone"
                  name="emergencyPhone"
                  class="form-input"
                  placeholder="10-digit mobile number"
                  required
                />
                <div class="error-message" id="emergencyPhoneError">
                  Please enter a valid phone number
                </div>
              </div>
            </div>

            <!-- Optional: Add Special Requirements field if needed -->
            <div class="form-group">
              <label class="form-label" for="specialRequirements"
                >Special Requirements</label
              >
              <textarea
                id="specialRequirements"
                name="specialRequirements"
                class="form-textarea"
                rows="3"
              ></textarea>
            </div>

            <div class="checkbox-group">
              <input
                type="checkbox"
                id="finalConsent"
                name="finalConsent"
                class="checkbox-input"
                required
              />
              <label for="finalConsent" class="checkbox-label"
                >I consent to my child's participation in the SKF Karate program
                and acknowledge all provided information is accurate.</label
              >
              <div class="error-message" id="finalConsentError"></div>
            </div>
          </div>

          <div class="form-section" id="section8">
            <h2 class="section-title">Thank You!</h2>
            <p class="section-subtitle">
              Your enrollment has been submitted successfully.
            </p>

            <div id="thankYouContent"></div>
            <a
              href="#"
              id="payBtn"
              class="btn btn-primary"
              target="_blank"
              style="display: none !important"
            >
              Proceed to Payment
            </a>
          </div>
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              id="prevBtn"
              onclick="previousStep()"
              style="display: none"
            >
              Previous
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="nextBtn"
              onclick="nextStep()"
            >
              Next
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              id="submitBtn"
              style="display: none"
            >
              Enrol
            </button>
          </div>
        </form>

        <!-- Section 9: Thank You & Payment -->
        <div class="form-section" id="section9" style="display: none">
          <h2 class="section-title">Thank You!</h2>
          <div id="thankYouMessage">
            <!-- Dynamic content will be populated here -->
          </div>
          <button
            type="button"
            class="btn btn-primary"
            id="payBtn"
            style="display: none"
          >
            Proceed to Payment
          </button>
        </div>
      </div>
    </div>

    <script>
      // Application state
      let currentStep = 1;
      let maxSteps = 8;
      let selectedPackage = null;
      let formData = {};

      // Package configurations
      const packages = {
        SKFEARLYBIRD: {
          name: "Early Bird Program",
          price: 4000,
          originalPrice: 6500,
          savings: 2500,
          registrationFee: 1500,
          monthlyTraining: 2500,
          freeWorkshop: true,
          childrenCount: 1,
          icon: "⭐",
        },
        SKFDUO: {
          name: "Family Duo Program",
          price: 7000,
          originalPrice: 13000,
          savings: 6000,
          pricePerChild: 3500,
          childrenCount: 2,
          familyDiscount: 1000,
          icon: "👥",
        },
        SKFTRIO: {
          name: "Family Trio Program",
          price: 9999,
          originalPrice: 19500,
          savings: 9501,
          pricePerChild: 3333,
          childrenCount: 3,
          familyDiscount: 2001,
          icon: "👪",
        },
        SKFREFERRAL: {
          name: "Referral Program",
          price: 3800,
          originalPrice: 4000,
          savings: 200,
          referrerCredit: 500,
          totalBenefit: 700,
          childrenCount: 1,
          icon: "🤝",
        },
        SKFDIWALI1: {
          name: "Diwali Offer — Single",
          childrenCount: 1,
          registrationFee: 1500,
          monthlyTraining: 2000,
          icon: "🎉",
        },
        SKFDIWALI2: {
          name: "Diwali Offer — Duo",
          childrenCount: 2,
          registrationFee: 1500,
          monthlyTraining: 2000,
          familyDiscount: 1000,
          icon: "🎉",
        },
        SKFDIWALI3: {
          name: "Diwali Offer — Trio",
          childrenCount: 3,
          registrationFee: 1500,
          monthlyTraining: 2000,
          familyDiscount: 2001,
          icon: "🎉",
        },
        STANDARD: {
          name: "Standard Program",
          price: 5000,
          registrationFee: 2500,
          monthlyTraining: 2500,
          childrenCount: 1,
          icon: "🎯",
        },
      };

      // Validation patterns
      const validationPatterns = {
        phone: /^[6-9]\d{9}$/,
        email: /.+@.+\..+/,
        promoCode: /^SKF[A-Z0-9]+$/, // allow digits for SKFDIWALI1/2/3
      };

      // REPLACE WITH YOUR DEPLOYED WEB APP URL
      const WEBHOOK_URL =
        "https://script.google.com/macros/s/AKfycbzxs5ixXE4dlbnA502G4ImzubaOd2Ol3VLPYSwIiapWqZTc8gobbqOQwuUK1IBEvn_K/exec";

      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("admissionForm");
        form.addEventListener("submit", submitForm);

        updateProgressBar();
        setupEventListeners();
        updateStepIndicator();
        updateButtons();
      });

      function setupEventListeners() {
        document
          .getElementById("promoCode")
          .addEventListener("input", validatePromoCode);

        document.getElementById("promoCode").addEventListener("input", () => {
          const helpLine = document.getElementById("promoHelpNote");
          if (helpLine) {
            helpLine.style.display = "none"; // hides the help line when user starts typing
          }
        });

        document
          .getElementById("guardianRelationship")
          .addEventListener("change", function () {
            toggleOtherField("guardianRelationship", "guardianOtherGroup");
          });
        document
          .getElementById("guardianRelationship2")
          .addEventListener("change", function () {
            toggleOtherField("guardianRelationship2", "guardianOther2Group");
          });
        document
          .getElementById("emergencyRelationship")
          .addEventListener("change", function () {
            toggleOtherField("emergencyRelationship", "emergencyOtherGroup");
          });
        document
          .getElementById("admissionForm")
          .addEventListener("submit", submitForm);
      }

      function validatePromoCode() {
        const promoInput = document.getElementById("promoCode");
        const errorElement = document.getElementById("promoCodeError");
        const details = document.getElementById("packageDetails");
        const raw = (promoInput.value || "").trim();
        const promoCode = raw.toUpperCase();

        const help = document.getElementById("promoHelpNote");
        if (help)
          help.textContent =
            "Have a promo code? Enter it here — or simply continue.";

        // Normalize promo code for Diwali codes
        const { baseKey, isDiwali, children } = normalizePromoCode(promoCode);

        // 1. If promo code is empty, show standard package
        if (!promoCode) {
          selectedPackage = packages["STANDARD"];
          updatePackageDetails("STANDARD");
          promoInput.classList.remove("error");
          errorElement.classList.remove("show");
          return true;
        }

        // 2. Validate promo code format
        if (!validationPatterns.promoCode.test(promoCode)) {
          showError(promoInput, errorElement, "Promo code must start with SKF");
          return false;
        }

        // 3. Check if promo code is valid (including Diwali mapped codes)
        if (packages[baseKey]) {
          selectedPackage = packages[baseKey];
          updatePackageDetails(promoCode);
          promoInput.classList.remove("error");
          errorElement.classList.remove("show");
          return true;
        }

        // 4. Promo code is formatted but unknown
        showError(promoInput, errorElement, "Invalid promo code");
        return false;
      }

      // Your normalizePromoCode function to map Diwali codes
      function normalizePromoCode(promo) {
        const p = (promo || "").toUpperCase().trim();
        if (p === "SKFDIWALI1")
          return { baseKey: "SKFEARLYBIRD", isDiwali: true, children: 1 };
        if (p === "SKFDIWALI2")
          return { baseKey: "SKFDUO", isDiwali: true, children: 2 };
        if (p === "SKFDIWALI3")
          return { baseKey: "SKFTRIO", isDiwali: true, children: 3 };
        return { baseKey: p, isDiwali: false, children: undefined };
      }

      function updatePackageDetails(promoCode) {
        const detailsContainer = document.getElementById("packageDetails");
        const { baseKey, isDiwali, children } = normalizePromoCode(promoCode);
        const pkg = packages[baseKey];
        if (!pkg) return;

        const c = pkg.childrenCount || children || 1;
        const regFee = pkg.registrationFee || 1500;
        const monthlyFee = pkg.monthlyTraining || 2500;
        let finalPrice = pkg.price || 0;
        let pricePerChild =
          pkg.pricePerChild || (finalPrice && Math.round(finalPrice / c));

        // Adjust for Diwali discount (₹500 per child on monthly fee)
        if (isDiwali && finalPrice) {
          const delta = 500 * c;
          finalPrice = Math.max(0, finalPrice - delta);
          pricePerChild = Math.round(finalPrice / c);
        }

        const packageTitle = `${
          pkg.icon
        } ${pkg.name.toUpperCase()} SELECTED`;

        let detailsHTML = `
    <div class="package-title">${packageTitle}</div>
    <div class="package-details">
  `;

        // Early Bird Program (Single Child)
        if (baseKey === "SKFEARLYBIRD") {
          const savings = isDiwali ? 3000 : 2500; // Base 2500 + 500 Diwali
          detailsHTML += `
      <div class="package-detail"><span class="icon">🎯</span> Registration Fee: <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regFee}</span></div>
      <div class="package-detail"><span class="icon">📅</span> Monthly Training Fee: `;
          if (isDiwali) {
            detailsHTML += `<span class="price-slashed">₹2,500</span> <span class="price-now-gold">₹2,000</span> <span class="note-gold">(Diwali Offer)</span>`;
          } else {
            detailsHTML += `<span class="price-highlight">₹${monthlyFee}</span>`;
          }
          detailsHTML += `</div>
      <div class="package-detail"><span class="icon">🛡️</span> Self-Defence Workshop: <span class="savings-highlight">Complimentary (1 × ₹1,500 = ₹1,500)</span></div>
      <div class="package-detail"><span class="icon">💵</span> Total Investment: <span class="price-highlight">₹${finalPrice}</span></div>
      <div class="package-detail"><span class="icon">💸</span> You Save: <span class="savings-highlight">₹${savings}!</span></div>`;
          if (isDiwali) {
            detailsHTML += `
      <div class="package-detail"><span class="icon">🎁</span> Monthly Lock-in: <span class="savings-highlight">Pay ₹2,000 instead of ₹2,500 every month — ₹500 savings locked permanently!</span></div>`;
          }
        }

        // Family Duo Program (Two Children)
        else if (baseKey === "SKFDUO") {
          // Keep original published numbers
          const publishedTotal = 7000; // investment stays 7000
          const publishedSavings = 6000; // savings stays 6000

          // Registration and monthly lines
          const regPerChild = regFee; // 1500 already shown with scratch
          const monthlyPerChild = isDiwali ? 2000 : pkg.monthlyTraining || 2500;

          // Family discount display rule
          const effectiveFamilyDiscount = isDiwali
            ? 0
            : pkg.familyDiscount || 1000;

          // Pricing presentation only; per-child shown from existing config if present
          finalPrice = publishedTotal;
          pricePerChild = pkg.pricePerChild || Math.round(publishedTotal / 2);

          detailsHTML += `
    <div class="package-detail"><span class="icon">🎯</span> Registration Fee (Child 1): <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regPerChild}</span></div>
    <div class="package-detail"><span class="icon">🎯</span> Registration Fee (Child 2): <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regPerChild}</span></div>
    <div class="package-detail"><span class="icon">📅</span> Monthly Training Fee (per child): ${
      isDiwali
        ? `<span class="price-slashed">₹2,500</span> <span class="price-now-gold">₹2,000</span> <span class="note-gold">(Diwali Offer)</span>`
        : `<span class="price-highlight">₹${monthlyPerChild}</span>`
    }</div>
    <div class="package-detail"><span class="icon">🛡️</span> Self-Defence Workshop: <span class="savings-highlight">Complimentary (2 × ₹1,500 = ₹3,000)</span></div>
    ${
      effectiveFamilyDiscount > 0
        ? `
      <div class="package-detail"><span class="icon">🎁</span> Family Discount: <span class="savings-highlight">-₹${effectiveFamilyDiscount}</span></div>
    `
        : ``
    }
    <div class="package-detail"><span class="icon">💵</span> Final Total: <span class="price-highlight">₹${publishedTotal.toLocaleString(
      "en-IN"
    )}</span> <span style="color: var(--text-secondary);">(₹${pricePerChild.toLocaleString(
            "en-IN"
          )} per child)</span></div>
    <div class="package-detail"><span class="icon">💸</span> Total Savings: <span class="savings-highlight">₹${publishedSavings.toLocaleString(
      "en-IN"
    )} overall!</span></div>
  `;
          if (isDiwali) {
            detailsHTML += `
    <div class="package-detail"><span class="icon">🎁</span> Monthly Lock-in: <span class="savings-highlight">Each child pays ₹2,000 instead of ₹2,500 every month — ₹1,000 family savings locked permanently!</span></div>`;
          }
        }

        // Family Trio Program (Three Children)
        else if (baseKey === "SKFTRIO") {
          // Keep original published numbers
          const publishedTotal = 9999; // investment stays 9999
          const publishedSavings = 9501; // savings stays 9501

          // Registration and monthly lines
          const regPerChild = regFee; // 1500
          const monthlyPerChild = isDiwali ? 2000 : pkg.monthlyTraining || 2500;

          // Family discount presentation rule for Diwali3
          const effectiveFamilyDiscount = isDiwali
            ? 501
            : pkg.familyDiscount || 2001;

          // Pricing presentation only; per-child from existing config if present
          finalPrice = publishedTotal;
          pricePerChild = pkg.pricePerChild || Math.round(publishedTotal / 3);

          detailsHTML += `
    <div class="package-detail"><span class="icon">🎯</span> Registration Fee (Child 1): <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regPerChild}</span></div>
    <div class="package-detail"><span class="icon">🎯</span> Registration Fee (Child 2): <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regPerChild}</span></div>
    <div class="package-detail"><span class="icon">🎯</span> Registration Fee (Child 3): <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regPerChild}</span></div>
    <div class="package-detail"><span class="icon">📅</span> Monthly Training Fee (per child): ${
      isDiwali
        ? `<span class="price-slashed">₹2,500</span> <span class="price-now-gold">₹2,000</span> <span class="note-gold">(Diwali Offer)</span>`
        : `<span class="price-highlight">₹${monthlyPerChild}</span>`
    }</div>
    <div class="package-detail"><span class="icon">🛡️</span> Self-Defence Workshop: <span class="savings-highlight">Complimentary (3 × ₹1,500 = ₹4,500)</span></div>
    <div class="package-detail"><span class="icon">🎁</span> Family Discount: <span class="savings-highlight">-₹${effectiveFamilyDiscount}</span></div>
    <div class="package-detail"><span class="icon">💵</span> Final Total: <span class="price-highlight">₹${publishedTotal.toLocaleString(
      "en-IN"
    )}</span> <span style="color: var(--text-secondary);">(₹${pricePerChild.toLocaleString(
            "en-IN"
          )} per child)</span></div>
    <div class="package-detail"><span class="icon">💸</span> Total Savings: <span class="savings-highlight">₹${publishedSavings.toLocaleString(
      "en-IN"
    )} overall!</span></div>
  `;
          if (isDiwali) {
            detailsHTML += `
    <div class="package-detail"><span class="icon">🎁</span> Monthly Lock-in: <span class="savings-highlight">Each child pays ₹2,000 instead of ₹2,500 every month — ₹1,500 family savings locked permanently!</span></div>`;
          }
        }

        // Referral Program
        else if (baseKey === "SKFREFERRAL") {
          detailsHTML += `
      <div class="package-detail"><span class="icon">🎯</span> Registration Fee: <span class="price-slashed">₹2,500</span> → <span class="price-highlight">₹${regFee}</span></div>
      <div class="package-detail"><span class="icon">📅</span> Monthly Training Fee: <span class="price-highlight">₹2,500</span></div>
      <div class="package-detail"><span class="icon">💵</span> Total per child: <span class="price-slashed">₹4,000</span> → <span class="price-highlight">₹${
        pkg.price || 3800
      }</span> <span style="color: var(--text-secondary);">(5% discount)</span></div>
      <div class="package-detail"><span class="icon">🎁</span> Referrer receives credit: <span class="savings-highlight">₹${
        pkg.referrerCredit || 500
      }</span> <span style="color: var(--text-secondary);">(for future monthly training fees)</span></div>
      <div class="package-detail"><span class="icon">💸</span> Total Referrer Benefit: <span class="savings-highlight">₹${
        pkg.totalBenefit || 700
      }!</span></div>
      <div class="package-detail"><span class="icon">🤝</span> Both you and your friend enjoy benefits when joining together!</div>`;
        }

        // Standard Program
        else if (baseKey === "STANDARD") {
          detailsHTML += `
      <div class="package-detail"><span class="icon">🎯</span> Registration Fee: <span class="price-highlight">₹2,500</span></div>
      <div class="package-detail"><span class="icon">📅</span> Monthly Training Fee: <span class="price-highlight">₹2,500</span></div>
      <div class="package-detail"><span class="icon">💵</span> Total Investment: <span class="price-highlight">₹5,000</span></div>`;
        }

        detailsHTML += `</div>`;
        detailsContainer.innerHTML = detailsHTML;
        selectedPackage = { ...pkg, price: finalPrice, pricePerChild };
      }

      function nextStep() {
        console.log("Attempting to move to next step from Step", currentStep);
        if (validateCurrentStep()) {
          console.log("Validation passed for Step", currentStep);
          if (currentStep < maxSteps) {
            hideSection(currentStep);
            currentStep++;
            while (shouldSkipSection(currentStep) && currentStep <= maxSteps) {
              currentStep++;
            }
            if (currentStep <= maxSteps) {
              showSection(currentStep);
              updateProgressBar();
              updateStepIndicator();
              updateButtons();
              if (currentStep === 4) {
                generateChildrenForms();
              } else if (currentStep === 5) {
                generateExperienceForms();
              }
              console.log("Moved to Step", currentStep);
            }
          }
        } else {
          console.log("Validation failed for Step", currentStep);
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          hideSection(currentStep);
          currentStep--;
          while (shouldSkipSection(currentStep) && currentStep >= 1) {
            currentStep--;
          }
          if (currentStep >= 1) {
            showSection(currentStep);
            updateProgressBar();
            updateStepIndicator();
            updateButtons();
          }
        }
      }

      function shouldSkipSection(step) {
        if (step === 5) {
          const childrenCount = selectedPackage
            ? selectedPackage.childrenCount
            : 1;
          for (let i = 1; i <= childrenCount; i++) {
            const hasExperience = document.querySelector(
              `input[name="child${i}MartialArts"]:checked`
            );
            if (hasExperience && hasExperience.value === "yes") return false;
          }
          return true;
        }
        if (step === 6)
          return (
            !selectedPackage || selectedPackage.name !== "Referral Program"
          );
        return false;
      }

      function validateCurrentStep() {
        let isValid = true;
        const currentSection = document.getElementById(`section${currentStep}`);
        const requiredFields = currentSection.querySelectorAll("[required]");

        requiredFields.forEach((field) => {
          if (!validateField(field)) {
            isValid = false;
          }
        });

        if (currentStep === 2) {
          const termsAccept = document.getElementById("termsAccept");
          if (termsAccept && !termsAccept.checked) {
            showError(
              termsAccept,
              document.getElementById("termsAcceptError"),
              "Please accept the terms and conditions"
            );
            isValid = false;
          } else {
            const errorElement = document.getElementById("termsAcceptError");
            if (errorElement) errorElement.classList.remove("show");
          }
        }

        if (currentStep === 7) {
          const finalConsent = document.getElementById("finalConsent");
          if (finalConsent && !finalConsent.checked) {
            showError(
              finalConsent,
              document.getElementById("finalConsentError"),
              "Please provide final consent"
            );
            isValid = false;
          } else {
            const errorElement = document.getElementById("finalConsentError");
            if (errorElement) errorElement.classList.remove("show");
          }
        }

        if (currentStep === 7) {
          const emergencyRelationship = document.getElementById(
            "emergencyRelationship"
          );
          const emergencyOther = document.getElementById("emergencyOther");
          if (
            emergencyRelationship &&
            emergencyRelationship.value === "Other" &&
            !emergencyOther.value.trim()
          ) {
            showError(
              emergencyOther,
              document.getElementById("emergencyOtherError"),
              "Please specify the relationship"
            );
            isValid = false;
          }
        }

        if (currentStep === 1) {
          return validatePromoCode();
        }

        if (currentStep > 1 && !selectedPackage) {
          alert("Please apply a valid promo code first.");
          return false;
        }

        return isValid;
      }

      function validateField(field) {
        const value = field.value.trim();
        const fieldName = field.name;
        let isValid = true;
        let errorMessage = "";

        if (field.hasAttribute("required") && !value) {
          isValid = false;
          errorMessage = "This field is required";
        }

        if (value) {
          if (field.type === "tel" && !validationPatterns.phone.test(value)) {
            isValid = false;
            errorMessage = "Please enter a valid 10-digit mobile number";
          } else if (
            field.type === "email" &&
            !validationPatterns.email.test(value)
          ) {
            isValid = false;
            errorMessage = "Please enter a valid email address";
          }
        }

        const errorElement = document.getElementById(`${fieldName}Error`);
        if (errorElement) {
          if (isValid) {
            field.classList.remove("error");
            errorElement.classList.remove("show");
          } else {
            showError(field, errorElement, errorMessage);
          }
        }
        return isValid;
      }

      function showError(field, errorElement, message) {
        field.classList.add("error");
        errorElement.textContent = message;
        errorElement.classList.add("show");
      }

      function generateChildrenForms() {
        const container = document.getElementById("childrenContainer");
        const childrenCount = selectedPackage
          ? selectedPackage.childrenCount
          : 1;
        container.innerHTML = "";
        for (let i = 1; i <= childrenCount; i++) {
          const childHTML = `
                  <div class="child-section">
                      <h3 class="child-section-title">Child ${i} Information</h3>
                      <div class="form-row">
                          <div class="form-group">
                              <label class="form-label required" for="child${i}Name">Child's Full Name</label>
                              <input type="text" id="child${i}Name" name="child${i}Name" class="form-input" required>
                              <div class="error-message" id="child${i}NameError">Child's name is required</div>
                          </div>
                          <div class="form-group">
                              <label class="form-label required" for="child${i}Dob">Date of Birth</label>
                              <input type="date" id="child${i}Dob" name="child${i}Dob" class="form-input" required>
                              <div class="error-message" id="child${i}DobError">Date of birth is required</div>
                          </div>
                      </div>
                      <div class="form-row">
                          <div class="form-group">
                              <label class="form-label required" for="child${i}Gender">Gender</label>
                              <select id="child${i}Gender" name="child${i}Gender" class="form-select" required>
                                  <option value="">Select gender</option>
                                  <option value="Male">Male</option>
                                  <option value="Female">Female</option>
                                  <option value="Other">Other</option>
                              </select>
                              <div class="error-message" id="child${i}GenderError">Please select gender</div>
                          </div>
                          <div class="form-group">
                              <label class="form-label required" for="child${i}Siblings">Number of children in family</label>
                              <select id="child${i}Siblings" name="child${i}Siblings" class="form-select" required>
                                  <option value="">Select number</option>
                                  <option value="1">1</option>
                                  <option value="2">2</option>
                                  <option value="3">3</option>
                                  <option value="4">4</option>
                                  <option value="5+">5+</option>
                              </select>
                              <div class="error-message" id="child${i}SiblingsError">Please select number of children</div>
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="form-label required">Has your child trained in martial arts before?</label>
                          <div class="radio-group">
                              <div class="radio-option">
                                  <input type="radio" id="child${i}MartialArtsYes" name="child${i}MartialArts" value="yes" class="radio-input" required>
                                  <label for="child${i}MartialArtsYes" class="radio-label">Yes</label>
                              </div>
                              <div class="radio-option">
                                  <input type="radio" id="child${i}MartialArtsNo" name="child${i}MartialArts" value="no" class="radio-input" required>
                                  <label for="child${i}MartialArtsNo" class="radio-label">No</label>
                              </div>
                          </div>
                          <div class="error-message" id="child${i}MartialArtsError">Please select martial arts experience</div>
                      </div>
                      <div class="form-group">
                          <label class="form-label required">Does your child have any medical conditions?</label>
                          <div class="radio-group">
                              <div class="radio-option">
                                  <input type="radio" id="child${i}MedicalYes" name="child${i}Medical" value="yes" class="radio-input" required>
                                  <label for="child${i}MedicalYes" class="radio-label">Yes</label>
                              </div>
                              <div class="radio-option">
                                  <input type="radio" id="child${i}MedicalNo" name="child${i}Medical" value="no" class="radio-input" required>
                                  <label for="child${i}MedicalNo" class="radio-label">No</label>
                              </div>
                          </div>
                          <div class="error-message" id="child${i}MedicalError">Please select medical condition status</div>
                      </div>
                      <div class="form-group" id="child${i}MedicalDetailsGroup" style="display: none;">
                          <label class="form-label" for="child${i}MedicalDetails">Please specify medical conditions</label>
                          <textarea id="child${i}MedicalDetails" name="child${i}MedicalDetails" class="form-textarea" rows="3"></textarea>
                      </div>
                      <div class="form-group">
                          <label class="form-label" for="child${i}Medications">Current Medications (if any)</label>
                          <textarea id="child${i}Medications" name="child${i}Medications" class="form-textarea" rows="2"></textarea>
                      </div>
                  </div>
              `;
          container.innerHTML += childHTML;
          setTimeout(() => {
            const medicalYes = document.getElementById(`child${i}MedicalYes`);
            const medicalNo = document.getElementById(`child${i}MedicalNo`);
            const medicalDetailsGroup = document.getElementById(
              `child${i}MedicalDetailsGroup`
            );
            if (medicalYes)
              medicalYes.addEventListener("change", function () {
                if (this.checked) medicalDetailsGroup.style.display = "block";
              });
            if (medicalNo)
              medicalNo.addEventListener("change", function () {
                if (this.checked) medicalDetailsGroup.style.display = "none";
              });
          }, 0);
        }
      }

      function generateExperienceForms() {
        const container = document.getElementById("experienceContainer");
        const childrenCount = selectedPackage
          ? selectedPackage.childrenCount
          : 1;
        container.innerHTML = "";
        for (let i = 1; i <= childrenCount; i++) {
          const hasExperience = document.querySelector(
            `input[name="child${i}MartialArts"]:checked`
          );
          if (hasExperience && hasExperience.value === "yes") {
            const childrenLabel =
              selectedPackage.childrenCount === 1 ? "Child's" : `Child ${i}`;
            const experienceHTML = `
                      <div class="child-section">
                          <h3 class="child-section-title">Martial Arts Experience - ${childrenLabel}</h3>
                          <div class="form-row">
                              <div class="form-group">
                                  <label class="form-label" for="child${i}Duration">Duration of Training</label>
                                  <select id="child${i}Duration" name="child${i}Duration" class="form-select">
                                      <option value="">Select duration</option>
                                      <option value="Less than 6 months">Less than 6 months</option>
                                      <option value="6 months - 1 year">6 months - 1 year</option>
                                      <option value="1-2 years">1-2 years</option>
                                      <option value="2-3 years">2-3 years</option>
                                      <option value="3+ years">3+ years</option>
                                  </select>
                              </div>
                              <div class="form-group">
                                  <label class="form-label" for="child${i}Style">Style Practiced</label>
                                  <select id="child${i}Style" name="child${i}Style" class="form-select">
                                      <option value="">Select style</option>
                                      <option value="Karate">Karate</option>
                                      <option value="Taekwondo">Taekwondo</option>
                                      <option value="Judo">Judo</option>
                                      <option value="Kung Fu">Kung Fu</option>
                                      <option value="Mixed Martial Arts">Mixed Martial Arts</option>
                                      <option value="Other">Other</option>
                                  </select>
                              </div>
                          </div>
                          <div class="form-group">
                              <label class="form-label" for="child${i}Dojo">Previous Dojo or Instructor Name</label>
                              <input type="text" id="child${i}Dojo" name="child${i}Dojo" class="form-input">
                          </div>
                          <div class="form-group">
                              <label class="form-label" for="child${i}Belt">Current Belt Rank</label>
                              <select id="child${i}Belt" name="child${i}Belt" class="form-select">
                                  <option value="">Select belt rank</option>
                                  <option value="White Belt">White Belt</option>
                                  <option value="Yellow Belt">Yellow Belt</option>
                                  <option value="Orange Belt">Orange Belt</option>
                                  <option value="Green Belt">Green Belt</option>
                                  <option value="Blue Belt">Blue Belt</option>
                                  <option value="Brown Belt">Brown Belt</option>
                                  <option value="Black Belt">Black Belt</option>
                              </select>
                          </div>
                          <div class="form-group">
                              <label class="form-label" for="child${i}Competition">Competition Experience or Recent Injuries</label>
                              <textarea id="child${i}Competition" name="child${i}Competition" class="form-textarea" rows="3"></textarea>
                          </div>
                      </div>
                  `;
            container.innerHTML += experienceHTML;
          }
        }
      }

      function toggleOtherField(selectId, groupId) {
        const select = document.getElementById(selectId);
        const group = document.getElementById(groupId);
        if (select && group) {
          group.style.display = select.value === "Other" ? "block" : "none";
        }
      }

      function showSection(step) {
        document.getElementById(`section${step}`).classList.add("active");
        if (step === 6) {
          [
            "friendName",
            "friendChildName",
            "friendContact",
            "referrer",
          ].forEach((field) => {
            const el = document.getElementById(field);
            if (el) el.setAttribute("required", "");
          });
          document.getElementById("referred")?.setAttribute("required", "");
        }
      }

      function hideSection(step) {
        document.getElementById(`section${step}`).classList.remove("active");
        if (step === 6) {
          [
            "friendName",
            "friendChildName",
            "friendContact",
            "referrer",
            "referred",
          ].forEach((field) => {
            const el = document.getElementById(field);
            if (el) el.removeAttribute("required");
          });
        }
      }

      function updateProgressBar() {
        const progress = (currentStep / maxSteps) * 100;
        document.getElementById("progressFill").style.width = `${progress}%`;
      }

      function updateStepIndicator() {
        const stepNames = [
          "Welcome &amp; Promo Code",
          "Package Confirmation",
          "Family &amp; Guardian Details",
          "Children Information",
          "Martial Arts Experience",
          "Referral Information",
          "Emergency Contact &amp; Final Details",
          "Thank You & Payment", // Add this as the 9th entry
        ];
        document.getElementById(
          "stepIndicator"
        ).innerHTML = `Step ${currentStep} of ${maxSteps}: ${
          stepNames[currentStep - 1]
        }`;
      }

      function updateButtons() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const submitBtn = document.getElementById("submitBtn");

        // Step 8 (Thank You & Payment): hide ALL nav
        if (currentStep === 8) {
          prevBtn.style.display = "none";
          nextBtn.style.display = "none";
          submitBtn.style.display = "none";
          return;
        }

        // Previous shown for steps 2-7, not 8
        prevBtn.style.display = currentStep > 1 ? "inline-flex" : "none";
        nextBtn.style.display = currentStep < 7 ? "inline-flex" : "none";
        submitBtn.style.display = currentStep === 7 ? "inline-flex" : "none";
      }

      async function submitForm(event) {
        event.preventDefault();
        if (!validateCurrentStep()) return;
        // ➊ Hide nav buttons right away
        document
          .querySelectorAll(".form-actions")
          .forEach((el) => (el.style.display = "none"));

        // Show loading overlay
        const overlay = document.getElementById("loadingOverlay");
        const loadingText = document.getElementById("loadingText");
        overlay.classList.remove("hidden");
        let percent = 0;
        const loadingInterval = setInterval(() => {
          percent += 2;
          if (percent >= 95) percent = 95;
          loadingText.textContent = `Processing... ${Math.floor(percent)}%`;
        }, 10);

        // Hide current section during submission
        hideSection(currentStep);

        // Collect form data
        const rawFormData = new FormData(
          document.getElementById("admissionForm")
        );
        const rawData = Object.fromEntries(rawFormData.entries());
        const childrenCount = selectedPackage
          ? selectedPackage.childrenCount
          : 1;
        const data = {
          promoCode: rawData.promoCode || "",
          packageName: selectedPackage ? selectedPackage.name : "",
          totalPrice: selectedPackage ? selectedPackage.price : "",
          primaryGuardianName: rawData.guardianName || "",
          primaryGuardianRelationship:
            rawData.guardianOther || rawData.guardianRelationship || "",
          primaryGuardianContact: rawData.guardianContact || "",
          primaryGuardianEmail: rawData.guardianEmail || "",
          primaryGuardianWhatsApp: rawData.guardianWhatsapp || "",
          secondaryGuardianName: rawData.guardianName2 || "",
          secondaryGuardianRelationship:
            rawData.guardianOther2 || rawData.guardianRelationship2 || "",
          secondaryGuardianContact: rawData.guardianContact2 || "",
          child1Name: rawData.child1Name || "",
          child1DOB: rawData.child1Dob || "",
          child1Gender: rawData.child1Gender || "",
          child1Siblings: rawData.child1Siblings || "",
          child1MartialArtsExperience: rawData.child1MartialArts || "",
          child1MedicalConditions: rawData.child1Medical || "",
          child1MedicalDetails: rawData.child1MedicalDetails || "",
          child1CurrentMedications: rawData.child1Medications || "",
          child1MartialArtsDuration: rawData.child1Duration || "",
          child1PreviousDojo: rawData.child1Dojo || "",
          child1MartialArtsStyle: rawData.child1Style || "",
          child1CurrentBeltRank: rawData.child1Belt || "",
          child1CompetitionExperience: rawData.child1Competition || "",
          child2Name: childrenCount >= 2 ? rawData.child2Name || "" : "",
          child2DOB: childrenCount >= 2 ? rawData.child2Dob || "" : "",
          child2Gender: childrenCount >= 2 ? rawData.child2Gender || "" : "",
          child2MartialArtsExperience:
            childrenCount >= 2 ? rawData.child2MartialArts || "" : "",
          child2MedicalConditions:
            childrenCount >= 2 ? rawData.child2Medical || "" : "",
          child2MedicalDetails:
            childrenCount >= 2 ? rawData.child2MedicalDetails || "" : "",
          child2CurrentMedications:
            childrenCount >= 2 ? rawData.child2Medications || "" : "",
          child2MartialArtsDuration:
            childrenCount >= 2 ? rawData.child2Duration || "" : "",
          child2PreviousDojo:
            childrenCount >= 2 ? rawData.child2Dojo || "" : "",
          child2MartialArtsStyle:
            childrenCount >= 2 ? rawData.child2Style || "" : "",
          child2CurrentBeltRank:
            childrenCount >= 2 ? rawData.child2Belt || "" : "",
          child2CompetitionExperience:
            childrenCount >= 2 ? rawData.child2Competition || "" : "",
          child3Name: childrenCount >= 3 ? rawData.child3Name || "" : "",
          child3DOB: childrenCount >= 3 ? rawData.child3Dob || "" : "",
          child3Gender: childrenCount >= 3 ? rawData.child3Gender || "" : "",
          child3MartialArtsExperience:
            childrenCount >= 3 ? rawData.child3MartialArts || "" : "",
          child3MedicalConditions:
            childrenCount >= 3 ? rawData.child3Medical || "" : "",
          child3MedicalDetails:
            childrenCount >= 3 ? rawData.child3MedicalDetails || "" : "",
          child3CurrentMedications:
            childrenCount >= 3 ? rawData.child3Medications || "" : "",
          child3MartialArtsDuration:
            childrenCount >= 3 ? rawData.child3Duration || "" : "",
          child3PreviousDojo:
            childrenCount >= 3 ? rawData.child3Dojo || "" : "",
          child3MartialArtsStyle:
            childrenCount >= 3 ? rawData.child3Style || "" : "",
          child3CurrentBeltRank:
            childrenCount >= 3 ? rawData.child3Belt || "" : "",
          child3CompetitionExperience:
            childrenCount >= 3 ? rawData.child3Competition || "" : "",
          friendName: rawData.friendName || "",
          friendChildName: rawData.friendChildName || "",
          friendContact: rawData.friendContact || "",
          referrerStatus: rawData.referrerStatus || "",
          emergencyContactName: rawData.emergencyName || "",
          emergencyContactRelationship:
            rawData.emergencyOther || rawData.emergencyRelationship || "",
          emergencyContactPhone: rawData.emergencyPhone || "",
          specialRequirements: rawData.specialRequirements || "",
          termsAccepted:
            rawData.termsAccept === "on" && rawData.finalConsent === "on"
              ? "Yes"
              : "No",
        };

        try {
          const response = await fetch(WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(data),
          });

          if (!response.ok)
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          const resultText = await response.text();
          let parsedResult = {
            status: "success",
            message: "Submitted!",
            upiLink: "",
            applicantId: "",
          };
          try {
            parsedResult = JSON.parse(resultText);
          } catch {}

          //Complete loading and hide overlay
          clearInterval(loadingInterval);
          loadingText.textContent = `Completed 100%`;
          setTimeout(() => overlay.classList.add("hidden"), 450);

          // Navigate to Thank You page
          currentStep = 8;
          showSection(currentStep); // Show only Section 8
          updateProgressBar();
          updateStepIndicator();
          updateButtons(); // This should hide prev/next/submit
          // Now, thankYouContent and payBtn manipulation

          // Populate Thank You message with child names
          const children = [];
          for (let i = 1; i <= childrenCount; i++) {
            if (rawData[`child${i}Name`]) {
              children.push(rawData[`child${i}Name`]);
            }
          }
          const childList = children.length
            ? children.join(", ")
            : "your child";
          document.getElementById("thankYouContent").innerHTML = `
            <p class="note"><br> <big>Congratulations, <b>${data.primaryGuardianName}!</b></big> Your enrollment for <big><b>${childList}</b></big> has been successfully submitted to <big>Sports Karate-do Fitness & Self Defence Association</big>.</p>
            <br>
            <p class="note">Please check your email at <strong>${data.primaryGuardianEmail}</strong> for payment details and further instructions.</p>
            <!-- Spam Warning Section -->
            <div style="background:#3e1f00; border:2px solid #ffcc00; border-radius:8px; color:#ffcc00; padding:12px 16px; font-weight:bold; margin-top:20px; text-align:center;">
              ⚠️ If you don’t see this email in your inbox, please check your Spam or Junk folder and mark it as “Not Spam” to ensure smooth communication.
            </div>
            <br>
            <p class="note"><i> - Team SKF</i></p>
          `;

          // Show payment button with UPI link
          const payBtn = document.getElementById("payBtn");
          // payBtn.style.display = "block";
          payBtn.onclick = () => window.open(parsedResult.upiLink, "_blank");
        } catch (error) {
          clearInterval(loadingInterval);
          overlay.classList.add("hidden");
          alert("Submission failed. Please try again: " + error.message);
        }
      }

      updateButtons();
    </script>
  </body>
</html>

